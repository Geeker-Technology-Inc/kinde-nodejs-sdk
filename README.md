# @kinde-oss/kinde-nodejs-sdk

@kinde-oss/kinde-nodejs-sdk - JavaScript client for kinde_management_api
Provides endpoints to manage your Kinde Businesses
This SDK is automatically generated by the [OpenAPI Generator](https://openapi-generator.tech) project:

- API version: 1
- Package version: 1
- Build package: org.openapitools.codegen.languages.JavascriptClientCodegen
For more information, please visit [https://kinde.com/docs](https://kinde.com/docs)

## Installation

### For [Node.js](https://nodejs.org/)

#### npm

To publish the library as a [npm](https://www.npmjs.com/), please follow the procedure in ["Publishing npm packages"](https://docs.npmjs.com/getting-started/publishing-npm-packages).

Then install it via:

```shell
npm install @kinde-oss/kinde-nodejs-sdk --save
```

Finally, you need to build the module:

```shell
npm run build
```

##### Local development

To use the library locally without publishing to a remote npm registry, first install the dependencies by changing into the directory containing `package.json` (and this README). Let's call this `JAVASCRIPT_CLIENT_DIR`. Then run:

```shell
npm install
```

Next, [link](https://docs.npmjs.com/cli/link) it globally in npm with the following, also from `JAVASCRIPT_CLIENT_DIR`:

```shell
npm link
```

To use the link you just defined in your project, switch to the directory you want to use your kinde_management_api from, and run:

```shell
npm link /path/to/<JAVASCRIPT_CLIENT_DIR>
```

Finally, you need to build the module:

```shell
npm run build
```

#### git

If the library is hosted at a git repository, e.g.https://github.com/GIT_USER_ID/GIT_REPO_ID
then install it via:

```shell
    npm install GIT_USER_ID/GIT_REPO_ID --save
```

## Getting Started
### Register for Kinde
You need a Kinde domain to get started, e.g. `yourapp.kinde.com`.
If you haven’t already got a Kinde account, [register for free here](http://app.kinde.com/register) (no credit card required).

### Set callback URLs

1. In Kinde, go to **Settings** > **App keys**.
2. Add your callback URLs in the relevant fields. For example:

    - Allowed callback URLs - for example, `https://localhost:8000/callback`
    - Allowed logout redirect URLs - for example, `https://localhost:8000`

3. Select **Save**.

## Add environments

Kinde comes with a production environment, but you can set up other environments if you want to. Note that each environment needs to be set up independently, so you need to use the Environment subdomain in the code block above for those new environments.

## Configure your app

**Environment variables**

The following variables need to be replaced in the code snippets below.

-   `KINDE_DOMAIN` - your Kinde domain - e.g. `https://your_kinde_domain.kinde.com`
-   `KINDE_CLIENT_ID` - you can find this on the **App keys** page - e.g. `your_kinde_client_id`
-   `KINDE_CLIENT_SECRET` - you can find this on the **App keys** page - e.g. `your_kinde_client_secret`
-   `KINDE_REDIRECT_URL` - your callback url, make sure this URL is under your allowed callback redirect URLs. - e.g. `http://localhost:8000/callback`
-   `KINDE_LOGOUT_REDIRECT_URL` - where you want users to be redirected to after logging out, make sure this URL is under your allowed logout redirect URLs. - e.g. `http://localhost:8000`
-   `KINDE_HOMEPAGE_URI` - where you want users to be redirected to after login sucess - e.g. `http://localhost:8000/dashboard`

## Integrate with your app
Please follow the [installation](#installation) instruction and execute the following JS code:

```javascript
require('dotenv').config();
const express = require('express');
const { createKindeClient, GrantType } = require('@kinde-oss/kinde-nodejs-sdk');
const session = require('express-session');
const app = express();
const port = 3000;
app.use(
  session({
    secret: randomString(),
    saveUninitialized: true,
    cookie: { maxAge: 1000 * 60 * 60 * 24 },
    resave: false,
  }),
);

const options = {
  domain: process.env.KINDE_DOMAIN,
  clientId: process.env.KINDE_CLIENT_ID,
  clientSecret: process.env.KINDE_CLIENT_SECRET,
  redirectUri: process.env.KINDE_REDIRECT_URI,
  logoutRedirectUri: process.env.KINDE_LOGOUT_REDIRECT_URI,
  grantType: GrantType.PKCE,
  homepageUri: process.env.KINDE_HOMEPAGE_URI,
};

const client = createKindeClient(options);


// Configure Bearer (JWT) access token for authorization: kindeBearerAuth
var kindeBearerAuth = defaultClient.authentications['kindeBearerAuth'];
kindeBearerAuth.accessToken = "YOUR ACCESS TOKEN"

var api = new KindeManagementApi.OAuthApi()
var callback = function(error, data, response) {
  if (error) {
    console.error(error);
  } else {
    console.log('API called successfully. Returned data: ' + data);
  }
};
api.getUser(callback);

```

## Login and registration

The Kinde client provides methods for easy to implement login / registration by the  following JS code:

```javascript
...
app.get('/login', async (req, res) => {
  await client.login(req, res);
});

app.get('/register', async (req, res) => {
  await client.register(req, res);
});
...

```
## Manage redirects

When the user is redirected back to your site from Kinde, this will call your callback URL defined in the `KINDE_REDIRECT_URL` variable. You will need to route `/callback` to call a function to handle this.
```javascript
app.get('/callback', async (req, res) => {
  await client.callbackKinde(req, res);
});
```

## Logout

The Kinde client comes with a logout method.

```javascript
app.get('/logout', async (req, res) => {
  await client.logout(req, res);
});
```

## Get user information

You need to have already authenticated before you call the API, otherwise an error will occur.

```javascipts

```


### View users in Kinde

Go to the **Users** page in Kinde to see who has registered.

### User Permissions

After a user signs in and they are verified, the token return includes permissions for that user. [User permissions are set in Kinde](https://kinde.com/docs/user-management/user-permissions), but you must also configure your application to unlock these functions.

```javascript
"permissions" => [
    "create:todos",
    "update:todos",
    "read:todos",
    "delete:todos",
    "create:tasks",
    "update:tasks",
    "read:tasks",
    "delete:tasks",
];
```
We provide helper functions to more easily access permissions:

```javascript
client.getPermission('create:todos');
// ['orgCode' => 'org_1234', 'isGranted' => true]

client.getPermissions();
// ['orgCode' => 'org_1234', 'permissions' => ['create:todos', 'update:todos', 'read:todos']]
```

A practical example in code might look something like:

```javascript
if (client.getPermission("create:todos")['isGranted']) {
    // create new a todo
}
```
### Audience

An `audience` is the intended recipient of an access token - for example the API for your application. The audience argument can be passed to the Kinde client to request an audience be added to the provided token.

The audience of a token is the intended recipient of the token.

```javascript
const options = {
  domain: process.env.KINDE_DOMAIN,
  clientId: process.env.KINDE_CLIENT_ID,
  clientSecret: process.env.KINDE_CLIENT_SECRET,
  redirectUri: process.env.KINDE_REDIRECT_URI,
  logoutRedirectUri: process.env.KINDE_LOGOUT_REDIRECT_URI,
  grantType: GrantType.PKCE,
  homepageUri: process.env.KINDE_HOMEPAGE_URI,
  audience: 'api.example.com/v1'
};

const client = createKindeClient(options);

```

For details on how to connect, see [Register an API](https://kinde.com/docs/developer-tools/register-an-api/)

### Overriding scope

By default the KindeSDK SDK requests the following scopes:

-   profile
-   email
-   offline
-   openid

You can override this by passing scope into the KindeSDK

```javascript
...
const options = {
  domain: process.env.KINDE_DOMAIN,
  clientId: process.env.KINDE_CLIENT_ID,
  clientSecret: process.env.KINDE_CLIENT_SECRET,
  redirectUri: process.env.KINDE_REDIRECT_URI,
  logoutRedirectUri: process.env.KINDE_LOGOUT_REDIRECT_URI,
  grantType: GrantType.PKCE,
  homepageUri: process.env.KINDE_HOMEPAGE_URI,
  scope: 'openid profile email offline'
};

const client = createKindeClient(options);
```

### Getting claims

We have provided a helper to grab any claim from your id or access tokens. The helper defaults to access tokens:

```javascript
client.getClaim('aud');
// ['api.yourapp.com']

client.getClaim('given_name', 'id_token');
// 'David'
```

### Organizations Control

#### Create an organization

To have a new organization created within your application, you will need to run a similar function to below:

```javascript
...
app.get('/create-org', async (req, res) => {
  await client.createOrg(req, res);
})
...
```

You can also pass org_name as your organization
```javascript
    ...
    await client.createOrg(req, res, { org_name: 'your_org_name'});
    ...
```

#### Sign up and sign in to organizations

Kinde has a unique code for every organization. You’ll have to pass this code through when you register a new user. Example function below:

```javascript
    await client.register(req, res, {org_code: 'your_org_code'});
```

If you want a user to sign into a particular organization, pass this code along with the sign in method.

```javascript
    await client.login(req, res, {org_code: 'your_org_code'});
```

Following authentication, Kinde provides a json web token (jwt) to your application. Along with the standard information we also include the org_code and the permissions for that organization (this is important as a user can belong to multiple organizations and have different permissions for each). Example of a returned token:

```json
{
    "aud": [],
    "exp": 1658475930,
    "iat": 1658472329,
    "iss": "https://your_subdomain.kinde.com",
    "jti": "123457890",
    "org_code": "org_1234",
    "permissions": ["read:todos", "create:todos"],
    "scp": ["openid", "profile", "email", "offline"],
    "sub": "kp:123457890"
}
```

The id_token will also contain an array of organization that a user belongs to - this is useful if you want to build out an organization switcher for example.

```json
{
...
"org_codes": ["org_1234", "org_4567"]
...
}
```

There are two helper functions you can use to extract information:

```javascript
client.getOrganization();
// ['orgCode' => 'org_1234']

client.getUserOrganizations();
// ['orgCodes' => ['org_1234', 'org_abcd']]
```

## SDK API Reference

| Property                        | Type   | Is required | Default                      | Description                                                                         |
| ------------------------------- | ------ | ----------- | ---------------------------- | ----------------------------------------------------------------------------------- |
| host                            | string | Yes         |                              | Either your Kinde instance url or your custom domain. e.g https://yourapp.kinde.com |
| redirectUri                     | string | Yes         |                              | The url that the user will be returned to after authentication                      |
| clientId                        | string | Yes         |                              | The id of your application - get this from the Kinde admin area                     |
| clientSecret                    | string | Yes         |                              | The id secret of your application - get this from the Kinde admin area              |
| logoutRedirectUri               | string | Yes         |                              | Where your user will be redirected upon logout                                      |
| scope                           | string | No          | openid profile email offline | The scopes to be requested from Kinde                                               |


## KindeSDK methods

| Property             | Description                                                                                       | Arguments                        | Usage                                                                                  | Sample output                                                                                         |
| -------------------- | ------------------------------------------------------------------------------------------------- | -------------------------------- | -------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- |
| login                | Constructs redirect url and sends user to Kinde to sign in                                        | org\_code?: string               | await client.login(req,res, { org_code: 'org_code'});                                                                       |                                                                                                       |
| register             | Constructs redirect url and sends user to Kinde to sign up                                        | org\_code?: string               | await client.register(req,res, { org_code: 'org_code'} );  ();                                                                    |                                                                                                       |
| logout               | Logs the user out of Kinde                                                                        |                                  | await client.logout(req, res);                                                                      |                                                                                                       |
| callbackKinde             | Returns the raw access token from URL after logged from Kinde                                     |                                  | await client.callbackKinde(req, res);                                                                    | eyJhbGciOiJIUzI1...                                                                                   |
| createOrg            | Constructs redirect url and sends user to Kinde to sign up and create a new org for your business | org\_name?: string               | await client.createOrg(req, res); or client.createOrg(req, res,{'org\_name' : 'your organization name'}); | redirect                                                                                              |
| getClaim             | Gets a claim from an access or id token                                                           | claim: string, tokenKey?: string | client.getClaim('given\_name', 'id\_token');                                          | David'                                                                                                |
| getPermission        | Returns the state of a given permission                                                           | key: string                      | client.getPermission('read:todos');                                                   | \{'orgCode' : 'org\_1234', 'isGranted' : true\}                                                    |
| getPermissions       | Returns all permissions for the current user for the organization they are logged into            |                                  | $kinde->getPermissions();                                                              | \{'orgCode' : 'org\_1234', permissions : \['create:todos', 'update:todos', 'read:todos'\]\}       |
| getOrganization      | Get details for the organization your user is logged into                                         |                                  | client.getOrganization();                                                             | \{'orgCode' : 'org\_1234'\}                                                                          |
| getUserDetails       | Returns the profile for the current user                                                          |                                  | client.getUserDetails();                                                              | {'given\_name': 'Dave', 'id': 'abcdef', 'family\_name' : 'Smith', 'email' : 'dave@smith.com'\} |
| getUserOrganizations | Gets an array of all organizations the user has access to                                         |                                   |  client.getUserOrganizations();                                                                                        |                                                                                                       |

If you need help connecting to Kinde, please contact us at [support@kinde.com](mailto:support@kinde.com).

## Documentation for API Endpoints

All URIs are relative to *https://app.kinde.com*

Class | Method | HTTP request | Description
------------ | ------------- | ------------- | -------------
*KindeManagementApi.OAuthApi* | [**getUser**](docs/OAuthApi.md#getUser) | **GET** /oauth2/user_profile | Returns the details of the currently logged in user
*KindeManagementApi.OAuthApi* | [**getUserProfileV2**](docs/OAuthApi.md#getUserProfileV2) | **GET** /oauth2/v2/user_profile | Returns the details of the currently logged in user
*KindeManagementApi.OrganizationsApi* | [**addOrganizationUsers**](docs/OrganizationsApi.md#addOrganizationUsers) | **POST** /api/v1/organization/users | Assign Users to an Organization
*KindeManagementApi.OrganizationsApi* | [**createOrganization**](docs/OrganizationsApi.md#createOrganization) | **POST** /api/v1/organization | Create Organization
*KindeManagementApi.OrganizationsApi* | [**getOrgainzations**](docs/OrganizationsApi.md#getOrgainzations) | **GET** /api/v1/organizations | List Organizations
*KindeManagementApi.OrganizationsApi* | [**getOrganization**](docs/OrganizationsApi.md#getOrganization) | **GET** /api/v1/organization | Get Organization
*KindeManagementApi.OrganizationsApi* | [**getOrganizationUsers**](docs/OrganizationsApi.md#getOrganizationUsers) | **GET** /api/v1/organization/users | List Organization Users
*KindeManagementApi.OrganizationsApi* | [**removeOrganizationUsers**](docs/OrganizationsApi.md#removeOrganizationUsers) | **PATCH** /api/v1/organization/users | Remove Users from an Organization
*KindeManagementApi.UsersApi* | [**addOrganizationUsers**](docs/UsersApi.md#addOrganizationUsers) | **POST** /api/v1/organization/users | Assign Users to an Organization
*KindeManagementApi.UsersApi* | [**createUser**](docs/UsersApi.md#createUser) | **POST** /api/v1/user | Create User
*KindeManagementApi.UsersApi* | [**getOrganizationUsers**](docs/UsersApi.md#getOrganizationUsers) | **GET** /api/v1/organization/users | List Organization Users
*KindeManagementApi.UsersApi* | [**getUsers**](docs/UsersApi.md#getUsers) | **GET** /api/v1/users | List Users
*KindeManagementApi.UsersApi* | [**removeOrganizationUsers**](docs/UsersApi.md#removeOrganizationUsers) | **PATCH** /api/v1/organization/users | Remove Users from an Organization


## Documentation for Models

 - [KindeManagementApi.AddOrganizationUsers200Response](docs/AddOrganizationUsers200Response.md)
 - [KindeManagementApi.AddOrganizationUsersRequest](docs/AddOrganizationUsersRequest.md)
 - [KindeManagementApi.CreateOrganizationRequest](docs/CreateOrganizationRequest.md)
 - [KindeManagementApi.CreateUser200Response](docs/CreateUser200Response.md)
 - [KindeManagementApi.CreateUserRequest](docs/CreateUserRequest.md)
 - [KindeManagementApi.CreateUserRequestIdentitiesInner](docs/CreateUserRequestIdentitiesInner.md)
 - [KindeManagementApi.CreateUserRequestIdentitiesInnerDetails](docs/CreateUserRequestIdentitiesInnerDetails.md)
 - [KindeManagementApi.CreateUserRequestProfile](docs/CreateUserRequestProfile.md)
 - [KindeManagementApi.Organization](docs/Organization.md)
 - [KindeManagementApi.OrganizationUser](docs/OrganizationUser.md)
 - [KindeManagementApi.RemoveOrganizationUsers200Response](docs/RemoveOrganizationUsers200Response.md)
 - [KindeManagementApi.RemoveOrganizationUsersRequest](docs/RemoveOrganizationUsersRequest.md)
 - [KindeManagementApi.User](docs/User.md)
 - [KindeManagementApi.UserIdentity](docs/UserIdentity.md)
 - [KindeManagementApi.UserIdentityResult](docs/UserIdentityResult.md)
 - [KindeManagementApi.UserProfile](docs/UserProfile.md)
 - [KindeManagementApi.UserProfileV2](docs/UserProfileV2.md)


## Documentation for Authorization



### kindeBearerAuth

- **Type**: Bearer authentication (JWT)

